# 1주차 : JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가

- JVM이란 무엇인가
- 컴파일 하는 방법
- 실행하는 방법
- 바이트코드란 무엇인가
- JIT 컴파일러란 무엇이며 어떻게 동작하는지
- JVM 구성 요소
- JDK와 JRE의 차이

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20cf8f840d7da54da4af24bb07f77774bc/Untitled.png)

먼저 자바 코드가 실행되는 과정은,

Java언어로 프로그래밍된 파일을 Java컴파일러가 가상 기계어 파일인 Java클래스 파일로 만든다. 

다시 말해, 소스 코드를 Java바이트 코드로 번역한다. 

이후 Java바이트 코드를 JVM이 읽고 실행하게 된다.

## JVM이란 무엇인가?

JVM은 Java Virtual Machine의 줄임말로 OS마다 따로 코드를 작성해야 하는 번거로움 없이 Java가 플랫폼에 독립적일 수 있게 만들어준다.

virtual machine(가상기계)는 '컴퓨터 속의 컴퓨터'라고 생각하면 된다.

자바로 작성된 애플리케이션은 모두 이 가상컴퓨터(JVM)에서만 실행되기 때문에, 자바 애플리케이션이 실행되기 위해서는 반드시 JVM이 필요하다.

일반 애플리케이션의 코드는 OS만 거치고 하드웨어로 전달되는데, Java애플리케이션은 JVM을 한 번 더 거치고 실행시에 해석되기 때문에 속도가 느리다는 단점을 가지고 있었으나,

요즘엔 바이트 코드(컴파일된 자바코드)를 하드웨어의 기계어로 바로 변환해주는 [JIT컴파일러]()와 향상된 최적화 기술이 적용되어서 속도의 격차를 많이 줄였다.

일반 애플리케이션은 OS와 바로 붙어있기 때문에 OS종속적이다. 반면에 Java애플리케이션은 JVM하고만 상호작용을 하기 때문에 OS와 하드웨어에 독립적이라 다른 OS에서도 프로그램의 변경 없이 실행이 가능한 것이다. 단, JVM은 OS에 종속적이기 때문에 해당 OS에서 실행가능한 JVM이 필요하다.

간단히 말해 JVM은 Java 클래스 파일을 로드하고 바이트 코드를 해석하며, 메모리 등의 자원을 할당하고 관리하며 정보를 처리하는 작업을 하는 프로그램이다.

## 컴파일 하는 방법

- 컴파일이란?

소스 프로그램(작성하는 프로그래밍 언어) 를 기계어(컴퓨터가 읽을 수 있는 언어)로 변환하는 과정이다.

- 자바의 경우 (확장자)

.java 를 .class로 컴파일한다. (.class파일 생성)

javac : 자바 소스를 바이트 코드로 변환하는 컴파일러

## **실행하는 방법**

: 자바는 컴파일을 해준 뒤에 (.class 파일로 만든 후) JVM위에서 실행이 가능하다.

: 컴파일 뒤에 .class파일 실행.

jre의 bin 디렉토리에도 동시에 설치되어있는 자바 응용프로그램 실행기로 이 도구를 통해 JVM이 작동하며 자바프로그램이 실행

## **바이트코드란 무엇인가**

C가 컴파일을 하면 목적코드가 생성되는것과는 다르게 Java는 JVM이 이해할 수 있도록 바이트코드를 생성하게된다. 

바이트코드는 고급 언어로 작성된 소스 코드를 가상머신이 이해할 수 있는 중간 코드로 컴파일한 것을 말한다.

JVM을 위한 언어이므로 플랫폼에 대한 종속성 없이 JVM에서 실행되는 바이너리 코드(2진수)로, 

JVM이 플랫폼 독립적일수 있는 이유이다. 

## JIT 컴파일러란 무엇이며 어떻게 동작하는지

JIT = Just In Time

**(1) 컴파일 방식 :**  실행하기 전에 소스코드를 한꺼번에 컴퓨터가 읽을 수 있는 native machine (기계)어로 변환

**(2) 인터프리터 방식 :** 소스코드를 빌드시에 아무 것도 하지 않다가, 런타임시에 한줄 한줄 읽어가며 변환

따라서 인터프리터방식은 느릴 수 밖에 없다.

JIT는 이 두 가지 방식을 혼합한 것이다. 변환 작업은 인터프리터에 인해서 지속적으로 수행되지만 필요한 코드의 정보는 캐시에 담아두었다가(메모리에 담아두었다가) 재사용하게 된다.

javac 명령어로 바이트코드로 컴파일하면 JVM에서 JIT컴파일러로 컴퓨터가 알아 들을 수 있게 기계코드로 변환하는 것이다. 

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20cf8f840d7da54da4af24bb07f77774bc/Untitled%201.png)

## JVM 구성요소

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20cf8f840d7da54da4af24bb07f77774bc/Untitled%202.png)

클래스 로더가 컴파일된 자바 바이트코드를 런타임 데이터 영역에 로드하고, 실행 엔진이 자바 바이트코드를 실행한다.

### 클래스로더

컴파일타임이 아니라 런타임에 클래스를 처음으로 참조할 때 해당 클래스를 로드하고 링크하는 특징이 있다. 이 동적 로드를 담당하는 부분이 JVM의 클래스 로더이다.

### 런타임 데이터 영역

JVM이 운영체제 위에서 실행되면서 할당받는 메모리 영역이다. 런타임 데이터 영역은 Method Area, Heap Area, Stack Area, PC Register, Native Method Stack으로 나눌 수 있다.

**- Method Area**

모든 Thread에게 공유된다. 클래스 정보, 변수 정보, Method정보, static변수 정보, 상수 정보 등이 저장되는 영역

**- Heap Area**

모든 Thread에게 공유된다. new 명령어로 생성된 인스턴스와 객체가 저장되는 구역, 공간이 부족해지면 Garbage Collection이 실행된다.

**- Stack Area**

각 스레드마다 하나씩 생성된다. Method안에서 사용되는 값들(매개변수, 지역변수, 리턴 값 등)이 저장되는 구역, 메서드가 호출될 때 LIFO로 하나씩 생성되고, 메서드 실행이 완료되면 LIFO로 하나씩 지워진다.

**- PC Register**

각 스레드마다 하나씩 생성된다. CPU의 Register와 역할이 비슷하다. 현재 수행 중인 JVM명령의 주소 값이 저장된다.

**- Native Method Stack**

각 스레드마다 하나씩 생성된다. 다른 언어(C/C++ 등)의 메서드 호출을 위해 할당되는 구역 언어에 맞게 Stack이 형성되는 구역이다. JNI(Java Native Interface)라는 표준 규약을 제공한다.

### 실행엔진

클래스 로더를 통해 JVM 내의 런타임 데이터 영역에 배치된 바이트코드는 실행 엔진에 의해 실행된다. 실행 엔진은 자바 바이트코드를 명령어 단위로 읽어서 실행한다.

## JDK와 JRE의 차이

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20cf8f840d7da54da4af24bb07f77774bc/Untitled%203.png)

**JRE : Java Runtime Environment, 자바 실행 환경**

JVM, Java API

자바 애플리케이션을 실행하기 위한 **최소의 실행 환경**을 제공한다.

**JDK : Java Development Kit, 자바 개발 도구**

JVM, Java API, **Java Tool, Java Compiler**

JRE에서 제공하는 실행 환경뿐만 아니라 자바 개발에 필요한 여러 가지 명령어 그리고 **컴파일러**를 포함한다.

정리하자면, JDK는 JRE를 포함하고 있다.

일반적으로 컴퓨터에서 Java프로그램을 실행하는데에만 포커스를 둔다면 JRE만 설치해도 된다.

그러나 Java프로그래밍을 하려면 JDK를 설치해야한다.


Notion : https://wheat-paprika-e8f.notion.site/1-JVM-9f5feaaf84594534a271e8eb9ca03dd2
